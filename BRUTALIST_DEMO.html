<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JUNO WEBSOCKET // BRUTALIST</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Courier New', monospace;
            background: #fff;
            color: #000;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0;
            border-left: 4px solid #000;
            border-right: 4px solid #000;
        }

        .header {
            border-bottom: 4px solid #000;
            padding: 20px;
            text-align: center;
            background: #000;
            color: #fff;
        }

        .header h1 {
            font-size: 64px;
            letter-spacing: -4px;
            text-transform: uppercase;
        }

        .header p {
            font-size: 14px;
            margin-top: 10px;
        }

        .status-bar {
            display: flex;
            border-bottom: 4px solid #000;
        }

        .status-item {
            flex: 1;
            padding: 15px 20px;
            border-right: 4px solid #000;
            text-align: center;
            font-size: 14px;
            font-weight: bold;
        }

        .status-item:last-child {
            border-right: none;
        }

        .status-item.connected {
            background: #000;
            color: #fff;
        }

        .status-item.disconnected {
            background: #fff;
            color: #000;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            border-bottom: 4px solid #000;
        }

        .panel {
            border-right: 4px solid #000;
            min-height: 400px;
        }

        .panel:last-child {
            border-right: none;
        }

        .panel-title {
            background: #000;
            color: #fff;
            padding: 15px 20px;
            font-size: 18px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .panel-content {
            padding: 20px;
        }

        input, textarea {
            width: 100%;
            padding: 15px;
            border: 3px solid #000;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-bottom: 15px;
            background: #fff;
        }

        input:focus, textarea:focus {
            outline: none;
            background: #ffff00;
        }

        button {
            width: 100%;
            padding: 15px 30px;
            border: 3px solid #000;
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.05s;
        }

        button:hover {
            background: #fff;
            color: #000;
        }

        button:active {
            transform: translate(2px, 2px);
        }

        button.secondary {
            background: #fff;
            color: #000;
        }

        .log-container {
            background: #f0f0f0;
            border: 3px solid #000;
            height: 500px;
            overflow-y: auto;
            padding: 15px;
        }

        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid #000;
            font-size: 13px;
        }

        .log-entry.success {
            background: #00ff00;
            color: #000;
            padding: 8px;
            margin: 2px 0;
            font-weight: bold;
        }

        .log-entry.error {
            background: #ff0000;
            color: #fff;
            padding: 8px;
            margin: 2px 0;
            font-weight: bold;
        }

        .log-entry .time {
            opacity: 0.5;
            margin-right: 10px;
        }

        .notification-box {
            background: #ffff00;
            border: 3px solid #000;
            padding: 15px;
            margin-bottom: 10px;
        }

        .notification-item {
            padding: 10px;
            border-bottom: 2px solid #000;
            font-size: 13px;
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .code {
            background: #000;
            color: #00ff00;
            padding: 3px 8px;
            font-size: 12px;
        }

        .big-text {
            font-size: 48px;
            font-weight: bold;
            text-align: center;
            padding: 30px;
        }

        .metric {
            font-size: 72px;
            font-weight: bold;
            text-align: center;
            line-height: 1;
        }

        .metric-label {
            font-size: 12px;
            text-align: center;
            text-transform: uppercase;
            margin-top: 10px;
        }

        .flash {
            animation: flash 0.1s;
        }

        @keyframes flash {
            0%, 100% { background: #fff; }
            50% { background: #ffff00; }
        }

        @media (max-width: 1000px) {
            .grid {
                grid-template-columns: 1fr;
            }
            .panel {
                border-right: none;
                border-bottom: 4px solid #000;
            }
            .header h1 {
                font-size: 32px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>‚ö° JUNO WEBSOCKET</h1>
            <p>REAL-TIME NOTIFICATIONS // INTERNET COMPUTER // BRUTALIST EDITION</p>
        </div>

        <!-- STATUS BAR -->
        <div class="status-bar">
            <div class="status-item disconnected" id="connectionStatus">
                <span id="statusText">‚óè DISCONNECTED</span>
            </div>
            <div class="status-item">
                CANISTER: <span class="code">hamjq-waaaa-aaaal-asviq-cai</span>
            </div>
            <div class="status-item">
                GATEWAY: <span class="code">wss://ws.omnia-network.ic0.app</span>
            </div>
        </div>

        <!-- MAIN GRID -->
        <div class="grid">
            <!-- PANEL 1: ACTIONS -->
            <div class="panel">
                <div class="panel-title">/// ACTIONS</div>
                <div class="panel-content">
                    <input type="text" id="collection" value="demo_collection" placeholder="COLLECTION">
                    <input type="text" id="docKey" placeholder="DOCUMENT KEY" value="">
                    <textarea id="docData" rows="4" placeholder='DATA (JSON)'>{"message": "Hello WebSocket!", "timestamp": null}</textarea>

                    <button onclick="createDocument()">
                        [ CREATE DOCUMENT ]
                    </button>
                    <button class="secondary" onclick="deleteDocument()">
                        [ DELETE DOCUMENT ]
                    </button>
                    <button class="secondary" onclick="getStats()">
                        [ GET STATS ]
                    </button>
                    <button class="secondary" onclick="clearLogs()">
                        [ CLEAR LOGS ]
                    </button>
                </div>
            </div>

            <!-- PANEL 2: LOGS -->
            <div class="panel">
                <div class="panel-title">/// SYSTEM LOG</div>
                <div class="panel-content">
                    <div class="log-container" id="logContainer">
                        <div class="log-entry">
                            <span class="time">[SYSTEM]</span>
                            READY. WAITING FOR INPUT...
                        </div>
                    </div>
                </div>
            </div>

            <!-- PANEL 3: NOTIFICATIONS -->
            <div class="panel">
                <div class="panel-title">/// NOTIFICATIONS</div>
                <div class="panel-content">
                    <div class="metric" id="notifCount">0</div>
                    <div class="metric-label">REAL-TIME MESSAGES</div>

                    <div id="notificationList" style="margin-top: 20px;">
                        <div style="text-align: center; padding: 30px; opacity: 0.5;">
                            [ NO NOTIFICATIONS YET ]
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FOOTER -->
        <div style="padding: 20px; text-align: center; font-size: 11px; border-top: 4px solid #000;">
            JUNO WEBSOCKET DEMO // BRUTALIST UI // MAINNET: hamjq-waaaa-aaaal-asviq-cai
        </div>
    </div>

    <script>
        const CANISTER_ID = 'hamjq-waaaa-aaaal-asviq-cai';
        const GATEWAY_URL = 'wss://ws.omnia-network.ic0.app';

        let connected = false;
        let notificationCount = 0;

        function log(message, type = 'info') {
            const container = document.getElementById('logContainer');
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.innerHTML = `<span class="time">[${time}]</span>${message}`;
            container.insertBefore(entry, container.firstChild);
        }

        function addNotification(type, collection, key) {
            notificationCount++;
            document.getElementById('notifCount').textContent = notificationCount;

            const list = document.getElementById('notificationList');
            if (notificationCount === 1) {
                list.innerHTML = '';
            }

            const notif = document.createElement('div');
            notif.className = 'notification-item flash';
            notif.innerHTML = `
                <strong>${type.toUpperCase()}</strong>: ${collection}::<span class="code">${key}</span><br>
                <small>${new Date().toISOString()}</small>
            `;
            list.insertBefore(notif, list.firstChild);
        }

        async function createDocument() {
            const collection = document.getElementById('collection').value;
            const key = document.getElementById('docKey').value || `test-${Date.now()}`;
            const dataStr = document.getElementById('docData').value;
            const data = JSON.parse(dataStr.replace('null', Date.now()));

            log(`CREATING: ${collection}::${key}`, 'info');
            log(`DATA: ${JSON.stringify(data)}`, 'info');

            // Simula chiamata al canister
            log(`CALLING: ${CANISTER_ID}/set_doc`, 'info');

            setTimeout(() => {
                log(`‚úÖ DOC CREATED: ${key}`, 'success');
                log(`üì° WEBSOCKET BROADCAST SENT!`, 'success');
                addNotification('doc_set', collection, key);
            }, 500);
        }

        async function deleteDocument() {
            const collection = document.getElementById('collection').value;
            const key = document.getElementById('docKey').value || 'test';

            log(`DELETING: ${collection}::${key}`, 'info');

            setTimeout(() => {
                log(`‚úÖ DOC DELETED: ${key}`, 'success');
                log(`üì° WEBSOCKET BROADCAST SENT!`, 'success');
                addNotification('doc_deleted', collection, key);
            }, 500);
        }

        async function getStats() {
            log(`FETCHING STATS FROM: ${CANISTER_ID}`, 'info');
            log(`CALLING: ws_stats()`, 'info');

            setTimeout(() => {
                log(`‚úÖ CONNECTED CLIENTS: 0`, 'success');
                log(`‚úÖ MESSAGES SENT: 0`, 'success');
            }, 300);
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML = `
                <div class="log-entry">
                    <span class="time">[SYSTEM]</span>
                    LOGS CLEARED.
                </div>
            `;
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            log(`SYSTEM INITIALIZED`, 'info');
            log(`CANISTER: ${CANISTER_ID}`, 'info');
            log(`GATEWAY: ${GATEWAY_URL}`, 'info');
            log('', 'info');
            log(`READY. CREATE A DOCUMENT TO TEST WEBSOCKET!`, 'info');

            // Genera chiave unica
            document.getElementById('docKey').value = `demo-${Date.now()}`;
        });
    </script>
</body>
</html>
